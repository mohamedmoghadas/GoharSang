

@{
    ViewBag.Title = "ثبت ورودی";
    Layout = "~/Views/Shared/_layout.cshtml";
}



<div class="container dailyCol">
    <div class="row dailyRow">
        <div class="col dailyLDiv">
            <a class="btn btn-primary dailyBtnTop" href="~/Home/Index" role="button">صفحه اصلی</a>
            <br>

            <div class="row">
               

                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">اسم معدن</label>
                            <select id="SelectMine" class="select2-placeholer form-control" data-placeholder="انتخاب"></select>

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">نوع کوپ</label>
                            <select id="SelectCope" class="select3-placeholer form-control" data-placeholder="انتخاب"></select>

                        </div>
                    </div>


                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">وزن</label>
                            <input type="text" class="form-control txtLeft" id="weight">

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">طول</label>
                            <input type="text" class="form-control txtLeft" id="lenght">

                        </div>
                    </div>


                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">عرض</label>
                            <input type="text" class="form-control txtLeft" id="width">

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">ارتفاع</label>
                            <input type="text" class="form-control txtLeft" id="height">

                        </div>
                    </div>


                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">کد کوپ</label>
                            <input type="text" class="form-control txtLeft" id="Copcode">

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">انبار</label>
                            <select id="selectStore" class="select3-placeholer form-control" data-placeholder="انتخاب"></select>

                        </div>
                    </div>


                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">شماره ماشین</label>
                            <input type="text" id="Trucknumber" class="form-control txtLeft">

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">شماره حواله</label>
                            <input type="text" id="Transfernumber" class="form-control txtLeft">

                        </div>
                    </div>


                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">شماره باسکول</label>
                            <input type="text" class="form-control txtLeft" id="basculenumber">

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">تاریخ</label>
                            <input type="text" class="form-control txtLeft jalali-datepicker"  id="date" placeholder="">
                        </div>
                    </div>


                    <div class="col-sm-6">
                        <div class="form-group">
                            <label style="float:right">ساعت</label>
                            <input id="time" class="form-control" value=" @DateTime.Now.TimeOfDay.Minutes : @DateTime.Now.TimeOfDay.Hours @DateTime.Now.AddHours(24).ToString("tt", System.Globalization.CultureInfo.CreateSpecificCulture("fa-IR"))">

                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label>تصاویر</label>
                            <div class="col-sm-4 col-8" style="display:none">
                                <input type="file" id="file1" class="float-right" accept="image/*">
                                <input type="file" id="file2" class="float-right" accept="image/*">
                                <input type="file" id="file3" class="float-right" accept="image/*">
                                <input type="file" id="file4" class="float-right" accept="image/*">

                            </div>

                            <div class="row">
                                <div class="col-3">
                                    <button class="btn btn-primary fa fa-upload" onclick="file1.click()"></button>
                                </div>
                                <div class="col-3">
                                    <button class="btn btn-primary fa fa-upload" onclick="file2.click()"></button>
                                </div>
                                <div class="col-3">
                                    <button class="btn btn-primary fa fa-upload" onclick="file3.click()"></button>
                                </div>
                                <div class="col-3">
                                    <button class="btn btn-primary fa fa-upload" onclick="file4.click()"></button>
                                </div>
                            </div>
                            <label>نمایش</label>
                            <div class="row">
                                <div class="col-3">
                                    <img id="img1" class="rounded entryImg">
                                </div>
                                <div class="col-3">
                                    <img id="img2" class="rounded entryImg">
                                </div>
                                <div class="col-3">
                                    <img id="img3" class="rounded entryImg">
                                </div>
                                <div class="col-3">
                                    <img id="img4" class="rounded entryImg">
                                </div>


                            </div>
                        </div>
                    </div>


                
                    <div class="form-group">
                        <button class="btn btn-primary float-left SaveBtn" onclick="BtnRecordEntry()" name="lenght">ذخیره</button>

                    </div>


            </div>


            </div>
    </div>
</div>


@section localscript{


  
    <link href="~/js/Resource/css/plugins/select2/select2.css" rel="stylesheet">
    <link href="~/js/Resource/css/plugins/select3/select3.css" rel="stylesheet" />
    
    <script src="~/js/Resource/js/plugins/select2/select2.full.min.js"></script>
    <script src="~/js/Resource/js/plugins/select3/select3.full.min.js"></script>
   

    <script>
        $(document).ready(function () {


            $(".select2").select2();
            $(".select2-placeholer").select2({
                allowClear: true
            });

            $(".select3").select3();
            $(".select3-placeholer").select3({
                allowClear: true
            });
        });


    </script>



    <script>
        var count = 0;
        $(document).keyup(function (event) {

            if (SelectMine.value != 0 &&
                SelectCope.value != 0 &&
                weight.value != "" &&
                lenght.value != "" &&
                width.value != "" &&
                height.value != "" &&
                Copcode.value != "" &&
                selectStore.value != 0 &&
                Trucknumber.value != "" &&
                Transfernumber.value != "" &&
                date.value != "" &&
                time.value != "" &&
                basculenumber.value != "") {
                if (event.keyCode == 13) {
                    if (count == 0) {
                        count = 1;
                        BtnRecordEntry();
                    }

                }
            }
        });
    </script>

    <script>
        window.onload = load();

        function load() {
            getMine();
            getCops();
            getStore();
        }

        function getMine() {
            $.ajax({
                url: '/RecordEntry/getMine',
                data: null,
                type: 'post',
                beforeSend: function () {
                    $(LoadingGift).show();
                },
                success: function (data) {

                    $(LoadingGift).hide();


                    var str = "<option value='0'>لطفا موردی را انتخاب نمایید</option>";


                    for (var i in data) {

                        str += "<option value=" + data[i].Id + ">" + data[i].Display + "</option>";
                    }
                    SelectMine.innerHTML = str;


                }
            });

        }

        function getCops() {
            $.ajax({
                url: '/RecordEntry/getCops',
                data: null,
                type: 'post',
                beforeSend: function () {
                    $(LoadingGift).show();
                },
                success: function (data) {

                    $(LoadingGift).hide();


                    var str = "<option value='0'>لطفا موردی را انتخاب نمایید</option>";


                    for (var i in data) {

                        str += "<option value=" + data[i].Id + ">" + data[i].Display + "</option>";
                    }
                    SelectCope.innerHTML = str;


                }
            });

        }

        function getStore() {
            $.ajax({
                url: '/RecordEntry/getStore',
                data: null,
                type: 'post',
                beforeSend: function () {
                    $(LoadingGift).show();
                },
                success: function (data) {

                    $(LoadingGift).hide();


                    var str = "<option value='0'>لطفا موردی را انتخاب نمایید</option>";


                    for (var i in data) {

                        str += "<option value=" + data[i].Id + ">" + data[i].Display + "</option>";
                    }
                    selectStore.innerHTML = str;


                }
            });

        }


    </script>


    <script>
        jsShowPic(file1, img1);
        jsShowPic(file2, img2);
        jsShowPic(file3, img3);
        jsShowPic(file4, img4);

    </script>


    <script>

        var State = false;





        function BtnRecordEntry() {

            if (SelectMine.value == 0 ||
                SelectCope.value == 0 ||
                weight.value == "" ||
                lenght.value == "" ||
                width.value == "" ||
                height.value == "" ||
                Copcode.value == "" ||
                selectStore.value == 0 ||
                Trucknumber.value == "" ||
                Transfernumber.value == "" ||
                date.value == "" ||
                time.value == "" ||
                basculenumber.value == "") {
                AlertInAjax("تمامی اطلاعات را وارد نمایید", modalAlertInAjax, "alert-danger");
                $(modalAlertInAjax).modal("show");

                return;
            }
            else {

                if (State == false) {

                    State = true;


                    var formdataRecordEntry = new FormData();


                    formdataRecordEntry.append('_re.IdMine', SelectMine.value);

                    formdataRecordEntry.append('_re.IdCops', SelectCope.value);

                    formdataRecordEntry.append('_re.Weight', weight.value);

                    formdataRecordEntry.append('_re.length', lenght.value);

                    formdataRecordEntry.append('_re.width', width.value);

                    formdataRecordEntry.append('_re.Height', height.value);

                    formdataRecordEntry.append('_re.CopsCod', Copcode.value);

                    formdataRecordEntry.append('_re.IdStore', selectStore.value);

                    formdataRecordEntry.append('_re.Transfernumber', Transfernumber.value);

                    formdataRecordEntry.append('_re.Trucknumber', Trucknumber.value);

                    formdataRecordEntry.append('_re.Time', time.value);

                    formdataRecordEntry.append('_re.basculenumber', basculenumber.value);

                    formdataRecordEntry.append('_Date', date.value);



                    formdataRecordEntry.append("_file", file1.files[0]);
                    formdataRecordEntry.append("_file", file2.files[0]);
                    formdataRecordEntry.append("_file", file3.files[0]);
                    formdataRecordEntry.append("_file", file4.files[0]);


                    $.ajax({
                        url: "/RecordEntry/RecordEntry",
                        type: "POST",
                        beforeSend: function () {
                            $(LoadingGift).show();

                        },
                        error: function (data) {
                            State = false;

                            $(LoadingGift).hide();
                            if (data.status == 513) {

                                AlertInAjax("کدکوپ تکراری است", modalAlertInAjax, "alert-danger");
                                $(modalAlertInAjax).modal('show');

                                return;
                            }
                            if (data.status == 532) {

                                AlertInAjax("سایز فایل درست انتخاب نشده", modalAlertInAjax, "alert-danger");
                                $(modalAlertInAjax).modal('show');

                                return;
                            }
                            if (data.status == 530) {

                                AlertInAjax("نوع فایل درست انتخاب نشده", modalAlertInAjax, "alert-danger");
                                $(modalAlertInAjax).modal('show');


                                return;

                            }

                        },
                        data: formdataRecordEntry,
                        enctype: 'multipart/form-data',
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            count = 0;
                            State = false;

                            $(LoadingGift).hide();

                            AlertInAjax("عملیات با موفقیت انجام شد", modalAlertInAjax, "alert-success");
                            $(modalAlertInAjax).modal("show");
                            setInterval(function () { $(modalAlertInAjax).modal("hide"); }, 2000);
                            $(modalAlertInAjax).on("hidden.bs.modal", function () {

                                location.href = "/RecordEntry/Index";
                            });
                        }
                    });
                }


            }



        }
    </script>
}